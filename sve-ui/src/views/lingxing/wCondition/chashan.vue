<template>
  <div class="flow-style">
    <div class="flow-canvas">
      <div class="flow-pipeline">
        <div class="flow-pipe-right water" xy="85,86" pwidth="770"></div>
        <div class="flow-pipe-top air" xy="52,153" pheight="30" groups="SW93"></div>
        <div class="flow-pipe-top air" xy="92,153" pheight="200" groups="SW94"></div>
        <div class="flow-pipe-right air" xy="62,343" pwidth="40" groups="SW94"></div>
        <div class="flow-pipe-top air" xy="52,113" pheight="40" tgroups="SW93,SW94"></div>
        <div class="flow-pipe-left air" xy="62,143" pwidth="40" groups="SW94"></div>
        <div class="flow-pipe-right air" xy="62,515" pwidth="40" groups="SW74"></div>
        <div class="flow-pipe-right air" xy="62,640" pwidth="40" groups="SW83"></div>
        <div class="flow-pipe-top air" xy="92,420" pheight="105" groups="SW83,SW74"></div>
        <div class="flow-pipe-top air" xy="92,525" pheight="125" tgroups="SW83"></div>
        <div class="flow-pipe-right air" xy="92,411" pwidth="40" tgroups="SW83,SW74"></div>
        <div class="flow-pipe-top air" xy="132,301" pheight="120" tgroups="SW83,SW74"></div>
        <div class="flow-pipe-right air" xy="141,301" pwidth="590" tgroups="SW83,SW74"></div>
        <div class="flow-pipe-bottom air" xy="284,308" pheight="40" tgroups="SW83,SW74"></div>
        <div class="flow-pipe-bottom air" xy="725,301" pheight="40" tgroups="SW83,SW74"></div>
        <div class="flow-pipe-top med" xy="264,98" pheight="50" tgroups="SW82,SW87,SW89"></div>
        <div class="flow-pipe-right med" xy="184,138" pwidth="80" groups="SW82"></div>
        <div class="flow-pipe-left med" xy="274,138" pwidth="80" groups="SW87"></div>
        <div class="flow-pipe-top med" xy="184,147" pheight="50" groups="SW82"></div>
        <div class="flow-pipe-top med" xy="264,147" pheight="50" groups="SW89"></div>
        <div class="flow-pipe-top med" xy="344,147" pheight="50" groups="SW87"></div>
        <div class="flow-pipe-top med" xy="465,115" pheight="80" groups="SW76"></div>
        <div class="flow-pipe-top med" xy="635,87" pheight="50" tgroups="SW84,SW71"></div>
        <div class="flow-pipe-right med" xy="585,127" pwidth="50" groups="SW84"></div>
        <div class="flow-pipe-left med" xy="645,127" pwidth="50" groups="SW71"></div>
        <div class="flow-pipe-top med" xy="585,136" pheight="50" groups="SW84"></div>
        <div class="flow-pipe-top med" xy="685,136" pheight="50" groups="SW71"></div>
        <div class="flow-pipe-top med" xy="845,115" pheight="80" groups="SW75"></div>
        <div class="flow-pipe-top med" xy="286,368" pheight="80" groups="SW68"></div>
        <div class="flow-pipe-top med" xy="511,372" pheight="80" groups="SW70"></div>
        <div class="flow-pipe-top med" xy="725,375" pheight="80" groups="SW90"></div>
        <div class="flow-pipe-top med" xy="181,557" pheight="80" groups="SW72"></div>
        <div class="flow-pipe-top med" xy="390,540" pheight="50" tgroups="SW77,SW86,SW88"></div>
        <div class="flow-pipe-right med" xy="310,580" pwidth="80" groups="SW77"></div>
        <div class="flow-pipe-left med" xy="400,580" pwidth="80" groups="SW86"></div>
        <div class="flow-pipe-top med" xy="310,590" pheight="50" groups="SW77"></div>
        <div class="flow-pipe-top med" xy="390,590" pheight="50" groups="SW88"></div>
        <div class="flow-pipe-top med" xy="470,590" pheight="50" groups="SW86"></div>
        <div class="flow-pipe-left med" xy="610,548" pwidth="80" tgroups="SW73,SW69,SW85"></div>
        <div class="flow-pipe-top med" xy="680,550" pheight="40" tgroups="SW73,SW69,SW85"></div>
        <div class="flow-pipe-right med" xy="600,580" pwidth="80" groups="SW73"></div>
        <div class="flow-pipe-left med" xy="690,580" pwidth="80" groups="SW69"></div>
        <div class="flow-pipe-top med" xy="600,590" pheight="50" groups="SW73"></div>
        <div class="flow-pipe-top med" xy="680,590" pheight="50" groups="SW85"></div>
        <div class="flow-pipe-top med" xy="760,590" pheight="50" groups="SW69"></div>
        <div class="flow-pipe-right water" xy="855,86" pwidth="100" tgroups="SW92,SW91"></div>
        <div class="flow-pipe-right water" xy="954,86" pwidth="90" groups="SW91"></div>
        <div class="flow-pipe-bottom water" xy="944,96" pheight="100" groups="SW92"></div>
        <div class="flow-pipe-top water" xy="1044,96" pheight="100" groups="SW92"></div>
        <div class="flow-pipe-right water" xy="944,186" pwidth="100" groups="SW92"></div>
        <div class="flow-pipe-right water" xy="1044,86" pwidth="150" tgroups="SW92,SW91"></div>
        <div class="flow-pipe-bottom water" xy="1185,106" pheight="250"></div>
        <div class="flow-pipe-left water" xy="197,347" pwidth="1000"></div>
        <div class="flow-pipe-bottom water" xy="191,347" pheight="200"></div>
        <div class="flow-pipe-right water" xy="187,526" pwidth="620"></div>
        <div class="flow-pipe-top solid" xy="164,285" pheight="250"></div>
        <div class="flow-pipe-right solid" xy="164,285" pwidth="830"></div>
        <div class="flow-pipe-bottom solid" xy="989,285" pheight="180"></div>
        <div class="flow-pipe-right solid" xy="670,104" pwidth="90"></div>
        <div class="flow-pipe-bottom solid" xy="760,104" pheight="185"></div>
        <div class="flow-pipe-top solid" xy="509,294" pheight="80"></div>
        <div class="flow-pipe-top solid" xy="624,295" pheight="250"></div>
        <div class="flow-pipe-right solid" xy="976,444" pwidth="123"></div>
        <div class="flow-pipe-bottom solid" xy="1062,454" pheight="100"></div>
        <div class="flow-pipe-right solid" xy="1072,544" pwidth="40"></div>
        <div class="flow-pipe-bottom solid" xy="1062,553" pheight="90"></div>
        <div class="flow-pipe-right solid" xy="1062,643" pwidth="40"></div>
      </div>
      <div class="flow-element">
        <div class="flow-pool-med top-name" ename="调节池" xy="40,60"></div>
        <div id="SW93" class="flow-machine-fan flow-start" ename="鼓风机1" xy="30,175" groups="SW93"></div>
        <div id="SW94" class="flow-machine-fan flow-start" ename="鼓风机2" xy="30,308" groups="SW94"></div>
        <div class="flow-pool-med top-name" ename="前端芬顿" xy="240,60"></div>
        <div id="SW82" class="flow-pump-med flow-start" ename="硫酸加药泵1" xy="160,160" groups="SW82"></div>
        <div id="SW89" class="flow-pump-med flow-start" ename="双氧水加药泵1" xy="240,160" groups="SW89"></div>
        <div id="SW87" class="flow-pump-med flow-start" ename="亚铁加药泵1" xy="320,160" groups="SW87"></div>
        <div class="flow-pool-med top-name" ename="pH调整池" xy="440,60"></div>
        <div id="SW76" class="flow-pump-med flow-start" ename="硫酸加药泵2" xy="445,160" groups="SW76"></div>
        <div class="flow-pool-med top-name" ename="混凝沉淀池1" xy="610,60"></div>
        <div id="SW84" class="flow-pump-med flow-start" ename="PAC加药泵1" xy="560,160" groups="SW84"></div>
        <div id="SW71" class="flow-pump-med flow-start" ename="PAM加药泵1" xy="660,160" groups="SW71"></div>
        <div class="flow-pool-med top-name" ename="中间水池" xy="820,60"></div>
        <div class="flow-pump-med flow-start" ename="烧碱加药泵1" xy="825,160" id="SW75" groups="SW75"></div>
        <div class="flow-pump-up flow-start" ename="提升泵1" xy="980,50" id="SW91" groups="SW91"></div>
        <div class="flow-pump-up flow-start" ename="提升泵2" xy="980,150" id="SW92" groups="SW92"></div>
        <div class="flow-pool-med top-name" ename="水解酸化池" xy="1160,60"></div>
        <div class="flow-pool-med" ename="EGSB" xy="1160,320"></div>
        <div class="flow-pool-med body-name" ename="A段<br />缺氧池" xy="850,320"></div>
        <div class="flow-pool-med body-name" ename="A段<br />氧化池" xy="700,320"></div>
        <div class="flow-pump-med" ename="烧碱加药泵2" xy="705,420" id="SW90" groups="SW90"></div>
        <div class="flow-pool-med body-name" ename="A段<br />二沉池" xy="485,320"></div>
        <div class="flow-pump-med" ename="PAM加药泵2" xy="490,420" id="SW70" groups="SW70"></div>
        <div class="flow-pool-med body-name" ename="B段<br />缺氧池" xy="375,320"></div>
        <div class="flow-machine-fan flow-start" ename="鼓风机3" xy="30,480" id="SW74" groups="SW74"></div>
        <div class="flow-machine-fan flow-start" ename="鼓风机4" xy="30,610" id="SW83" groups="SW83"></div>
        <div class="flow-pool-med body-name" ename="B段<br />氧化池" xy="260,320"></div>
        <div class="flow-pump-med" ename="烧碱加药泵3" id="SW68" groups="SW68" xy="265,420"></div>
        <div class="flow-pool-med body-name" ename="B段<br />二沉池" xy="155,500"></div>
        <div class="flow-pump-med" ename="PAM加药泵3" xy="160,600" id="SW72" groups="SW72"></div>
        <div class="flow-pool-med top-name" ename="芬顿系统" xy="360,500"></div>
        <div class="flow-pump-med" ename="硫酸加药泵3" xy="285,600" id="SW77" groups="SW77"></div>
        <div class="flow-pump-med" ename="双氧水加药泵2" xy="365,600" id="SW88" groups="SW88"></div>
        <div class="flow-pump-med" ename="亚铁加药泵2" xy="445,600" id="SW86" groups="SW86"></div>
        <div class="flow-pool-med" ename="混凝沉淀池2" xy="600,500"></div>
        <div class="flow-pump-med" ename="PAM加药泵4" xy="575,600" id="SW73" groups="SW73"></div>
        <div class="flow-pump-med" ename="PAC加药泵2" xy="655,600" id="SW85" groups="SW85"></div>
        <div class="flow-pump-med" ename="烧碱加药泵4" xy="735,600" id="SW69" groups="SW69"></div>
        <div class="flow-pool-med body-name" ename="排放口" xy="790,500"></div>

        <div class="flow-pool-med body-name" ename="浓缩池" xy="965,415"></div>
        <div class="flow-machine-filter flow-start" ename="压滤机1" xy="1085,430"></div>
        <div class="flow-machine-filter flow-start" ename="压滤机2" xy="1085,530"></div>
        <div class="flow-machine-filter flow-start" ename="压滤机3" xy="1085,630"></div>
      </div>
      <div class="flow-label">
        <div id class="flow-label-tag" format="流量计" xy="1057,99"></div>
        <!-- 加药电流 -->
        <div id="E82" class="flow-label-tag" format="{}A" xy="160,250"></div>
        <div id="E89" class="flow-label-tag" format="{}A" xy="240,250"></div>
        <div id="E87" class="flow-label-tag" format="{}A" xy="320,250"></div>
        <div id="E76" class="flow-label-tag" format="{}A" xy="445,250"></div>
        <div id="E84" class="flow-label-tag" format="{}A" xy="560,250"></div>
        <div id="E71" class="flow-label-tag" format="{}A" xy="640,250"></div>
        <div id="E75" class="flow-label-tag" format="{}A" xy="825,250"></div>
        <div id="E91" class="flow-label-tag" format="{}A" xy="975,117"></div>
        <div id="E92" class="flow-label-tag" format="{}A" xy="975,216"></div>
        <div id="E93" class="flow-label-tag" format="{}A" xy="30,252"></div>
        <div id="E94" class="flow-label-tag" format="{}A" xy="30,386"></div>
        <div id="E74" class="flow-label-tag" format="{}A" xy="30,558"></div>
        <div id="E83" class="flow-label-tag" format="{}A" xy="30,687"></div>
        <div id="E68" class="flow-label-tag" format="{}A" xy="320,453"></div>
        <div id="E70" class="flow-label-tag" format="{}A" xy="545,453"></div>
        <div id="E90" class="flow-label-tag" format="{}A" xy="760,453"></div>
        <div id="E72" class="flow-label-tag" format="{}A" xy="157,690"></div>
        <div id="E77" class="flow-label-tag" format="{}A" xy="285,690"></div>
        <div id="E88" class="flow-label-tag" format="{}A" xy="365,690"></div>
        <div id="E86" class="flow-label-tag" format="{}A" xy="445,690"></div>
        <div id="E73" class="flow-label-tag" format="{}A" xy="575,690"></div>
        <div id="E85" class="flow-label-tag" format="{}A" xy="655,690"></div>
        <div id="E69" class="flow-label-tag" format="{}A" xy="735,690"></div>
        <!-- ph -->
        <div id="E81" class="flow-label-tag" format="{}" xy="247,81"></div>
        <div id="E80" class="flow-label-tag" format="{}" xy="448,80"></div>
        <div id="E79" class="flow-label-tag" format="{}" xy="370,522"></div>
        <div id="E78" class="flow-label-tag" format="{}" xy="609,523"></div>
      </div>
      <!-- <div class="flow-other">
        <div class="flow-online-data" xy="880,500">
          <li id="val_100001" class="flow-label-li" format="COD：{}mg/L">COD排放量</li>
          <li id="val_100035" class="flow-label-li" format="PH：{}">PH值</li>
        </div>
      </div>-->
    </div>
    <el-dialog title="近6小时数据（间隔10分钟）" :visible.sync="visible" width="30%" custom-class="lxworking">
      <div v-loading="loading">
        <h3>{{ title }}</h3>
        <ve-line :data="chartData" :legend-visible="false" :settings="chartSettings" :data-empty="dataEmpty"></ve-line>
      </div>
    </el-dialog>
  </div>
</template>
<script>
import VeLine from "v-charts/lib/line.common";
import { flowResize, flowRefresh } from "./flow-js.js";
import { workingCondition, workingMinute } from "@/api/lingxing";
import "v-charts/lib/style.css"

export default {
  components: { VeLine },
  data() {
    this.chartSettings = {
      labelMap: {
        "avgAmt": "",
      },
    }
    return {
      gkData: {},
      visible: false,
      oId: "",
      title: "",
      chartData: {
        columns: ["datadate", "avgAmt"],
        rows: [],
      },
      dataEmpty: false,
      loading: true,
    };
  },
  mounted() {
    this.getData();
    this.get();
    this.isDefault();
  },
  methods: {
    getMinute() {
      workingMinute(this.oId).then(res => {
        if (res.code === 200) {
          this.title = res.data.elementDesc;
          this.chartData.rows = res.data.data;
          this.dataEmpty = res.data.data.length > 0 ? false : true;
        }
        this.loading = false;
      })
    },
    getData() {
      workingCondition(100009511).then((res) => {
        if (res.code === 200) {
          this.gkData = res.data;
          flowRefresh(res.data);
        }
      });
    },
    isDefault() {
      $(".flow-canvas div").each(function(index, el) {
        let xy = $(this).attr("xy");
        if (xy) {
          let point = xy.split(",");
          if (point.length == 2) {
            $(this).animate({ top: point[1] + "px", left: point[0] + "px" });
          }
        }
        let ename = $(this).attr("ename");
        // console.log(ename);
        if (ename) {
          $(this).append("<span class=\"flow-name\">" + ename + "</span>");
        }
        let pwidth = $(this).attr("pwidth");
        if (pwidth) {
          $(this).css({
            width: pwidth + "px"
          })
        }
        let pheight = $(this).attr("pheight");
        if (pheight) {
          $(this).css({
            height: pheight + "px"
          })
        }
        let format = $(this).attr("format")
        if (format) {
          $(this).html(format);
        }
      })
      $("[tgroups]").each(function(index, el) {
        let ids = $(el).attr("tgroups").split(",")
        let isgo = false;
        $.each(ids, function(index, val) {
          if ($("#" + val).attr("class").indexOf("-start") >= 0) {
            isgo = true;
            return
          }
        })
        if ($(el).prop("class").indexOf("flow-pipe") >= 0) {
          if (isgo) {
            $(el).addClass("pipe-start");
            $(el).removeClass("pipe-stop");
          } else {
            $(el).addClass("pipe-stop");
            $(el).removeClass("pipe-start");
          }
        }
      })
    },
    get() {
      let _that = this;
      var sizePercent = $(document.body).height() / $(".flow-canvas").height();
      flowResize(sizePercent);
      $(window).resize(function() {
        var sizePercent =
          $(document.body).height() / $(".flow-canvas").height();
        flowResize(sizePercent);
      });
      $(".flow-label [id]").click(function() {
        _that.oId = $(this).attr("id").replace("E", "");
        _that.visible = true;
        _that.getMinute();
      });
    },
  },
};
</script>
<style>
@import "./flow-base.css";
</style>
